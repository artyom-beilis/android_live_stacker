<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="/media/img/facicon.png" >
    <link rel="stylesheet" href="/media/css/style.css">
    <title>OpenLiveStacker</title>
</head>
<body>
<div id='video' style="position:absolute; left:0; top:0; z-index:-2"></div>
<div id='thumb' style="display:none; position:absolute; right:0; top:0; z-index:-1;">
    <span id="thumb_video"><span>
</div>
<div id='stacking_ui_stats' style="position:absolute; right:0; bottom:0; display:none;">
    <span id="stats_info"></span>
</div>
<p id="open_camera"   style="display:inline" >Camera: <select id="camera_select"></select><button onclick="openCamera()">Open</button></p>
<p id='std_controls' style="display:none;" >
    <button class="comp_but settings_background" onclick="showConfig(true);">&nbsp;</button>
    <button style="display:none" id="stacking_ui_stack" class="comp_but" onclick="showStack(true);">≡</button>
    <button style="display:none" id="stacking_ui_solve" class="comp_but solve_background" onclick="showSolve(true);">&nbsp;</button>
    <button style="display:none" id="stacking_ui_pause" class="comp_but pause_background" onclick="ctlStack('pause');">&nbsp;</button>
    <button style="display:none" id="stacking_ui_resume" class="comp_but resume_background" onclick="ctlStack('resume');">&nbsp;</button>
    <button style="display:none" id="stacking_ui_save" class="comp_but save_background" onclick="ctlStack('save');" >&nbsp;</button>
    <button style="display:none" id="stacking_ui_cancel" class="comp_but cancel_background" onclick="ctlStack('cancel');" >&nbsp;</button>
    <button style="display:none" id="stacking_ui_pp" class="comp_but stretch_background" onclick="showPP(true);" >&nbsp;</button>
    <button style="display:none; float:right" id="stacking_ui_live" class="comp_but" onclick="toggleThumbLive();">L</button>
</p>
<div id='zoom_controls' style="display:none; position: absolute; bottom: 1mm; left: 1mm">
    <button class="comp_but" onclick="zoom(+1);">+</button>
    <button class="comp_but" onclick="zoom(-1);">-</button>
    <span id="current_zoom"></span>
</div>
<div class="config_div" id="stack" style="display:none; position:absolute; left:5%; top:5%; z-index:2 ; padding: 1% 1% 1% 1%; width: 88%; background:black; border: 1px solid red ">
    <span style="position:absolute; right:1mm; top:1mm">
        <button class="incdec_but" onclick="showStack(false);">X</button>
    </span>
    <table>
    <tr><td>Name</td><td><input class="val_input" id="stack_name" type="text" value="" ></td><td>&nbsp;</td></tr>
    <tr>
        <td>Stacking</td>
        <td>
        <select id="stack_type" onchange='updateStackSelect()'>
           <option value="dso" selected>Deep Space Object</option>
           <option value="calibration">Calibration Frame</option> 
        </select>
        <td>&nbsp;</td>
    </tr>
    <tr class="dso_config stack_opt" ><td>Derotate</td><td><input id="stack_field_derotation" type="checkbox" ></td><td>&nbsp;</td></tr>
    <tr class="dso_config stack_opt" ><td>Derotate Mirror</td><td><input id="stack_image_flip" type="checkbox" ></td><td>&nbsp;</td></tr>
    <tr class="dso_config stack_opt" ><td>Remove Satellites</td><td><input id="stack_remove_satellites" type="checkbox" ></td><td>&nbsp;</td></tr>
    <tr class="dso_config stack_opt" ><td>Object ID</td><td><input class="val_input" oninput="updateRADE(this.value)" id="stack_object" type="text" value="" ></td><td>for example: M31, NGC457</td></tr>
    <tr class="dso_config stack_opt" ><td>Target</td><td>RA:<input class="val_input" id="stack_ra" type="text" ></td><td>DE:<input class="val_input" id="stack_de" type="text" ></td></tr>
    <tr class="dso_config stack_opt" ><td>Darks</td><td><select id="stack_darks"></select></td><td>&nbsp;</td></tr>
    <tr class="dso_config stack_opt" ><td>Flats</td><td><select id="stack_flats"></select></td><td>&nbsp;</td></tr>
    <tr class="dso_config stack_opt" ><td>Dark Flats</td><td><select id="stack_dark_flats"></select></td><td>&nbsp;</td></tr>
    <tr class="stack_opt" ><td>Save Debug</td><td><input id="stack_save_data" type="checkbox" ></td><td>&nbsp;</td></tr>
    <tr class="stack_opt" ><td><button onclick='startStack();'>Start</button></td><td>&nbsp;</td><td>&nbsp;</td></tr>
    </table>
</div>
<div class="config_div" id="pp_control" style="display:none; position:absolute; left:5%; top:5%; z-index:2 ; padding: 1% 1% 1% 1%; width: 88%; background-color: transparent; border: 1px solid red ">
    <span style="position:absolute; right:1mm; top:1mm">
        <button class="incdec_but" onclick="showPP(false);">X</button>
    </span>
    <p>
        Auto:<input id="stack_auto_stretch" checked type="checkbox" onchange='updateAutoPP()' >
    </p>
    <div id="dynamic_parameters" style='display:none'>
      <table style='width:100%;'>
        <colgroup>
            <col span="1" style="width: 5%;">
            <col span="1" style="width: 5%;">
            <col span="1" style="width: 90%;">
        </colgroup>
        <tbody>
        <tr>
            <td class="slider_elem">L:</td>
            <td class="slider_elem"><span id="stack_stretch_low_disp">0.000</span></td>
            <td class="slider_elem"><input type="range" min="0" max="1000" value="0" class="slider" id="stack_stretch_low" onchange='updatePPLow()'></td>
        </tr>
        <tr>
            <td class="slider_elem">H:</td>
            <td class="slider_elem"><span id="stack_stretch_high_disp">1.000</span></td>
            <td class="slider_elem"><input type="range" min="1000" max="16000" value="1000" class="slider" id="stack_stretch_high" onchange='updatePPHigh()'><td>
        </tr>
        <tr>
            <td class="slider_elem">γ:</td>
            <td class="slider_elem"><span id="stack_stretch_gamma_disp">2.400</span></td>
            <td class="slider_elem"><input type="range" min="1000" max="8000" value="2400" class="slider" id="stack_stretch_gamma" onchange='updatePP()'></td>
        </tr>
        </tbody>
      </table>
    </div>
</div>
<div class="config_div" id="config" style="display:none; position:absolute; left:5%; top:5%; z-index:2 ; padding: 1% 1% 1% 1%; width: 88%; background:black; border: 1px solid red ">
    <span style="position:absolute; right:1mm; top:1mm">
        <button class="incdec_but" onclick="showConfig(false);">X</button>
    </span>
    <p><button onclick="selectConfig('camera');">Camera</button><button onclick="selectConfig('astap');">ASTAP</button><p>
    <div id="config_tab_camera" class="config_tab" >
        <p>Format: <select id="stream_format"></select> <span class="nowr">FR Lim.<input id="stream_max_framerate" class="val_input saved_input" type="number" step="1" value="10" /></span> <button onclick="startStream()" >Stream</button></p>
        <p>
            <span id="FS_tooggle" class="nowr" ><label for="FS_checked">Full screen</label><input id="FS_checked" type="checkbox" onchange="toggleFS(this.checked)" ></span>
            <span class="nowr" >Lat:<input class="val_input" id="stack_lat" type="number" step="0.01" ></span>
            <span class="nowr" >Lon:<input class="val_input" id="stack_lon" type="number" step="0.01"></span>
        </p>
        <table>
        <thead>
            <tr>
                <td>Name</td>
                <td>Value</td>
                <td>&nbsp;</td>
                <td>Range</td>
                <td>Def.</td>
            </td>
        <td>
        <tbody id='cam_controls' >
        </tbody>
        </table>
    </div>
    <div id="config_tab_astap" class="config_tab" style="display:none">
    <p>Ready databases: <span id="astap_ready_list">None</span></p>
    <p>DB:
        <select id="astap_download_db" onchange="switchASTAPURL();">
            <option value="d05" >D05, 10&deg;&gt;FOV&gt;0.6&deg;, 98MB </option>
            <option value="d20" >D20, 10&deg;&gt;FOV&gt;0.3&deg;, 382MB</option>
            <option value="d50" >D50, 10&deg;&gt;FOV&gt;0.2&deg;, 860MB</option>
        </select></p>
    <p>URL: <input id="astap_download_url" type="text" value="" style="width:50%" /></p>
    <p>
        <button id='download_start' onclick='downloadStart()'>Download</button><button id='download_stop' onclick='downloadStop()'>Cancel</button>
        <span id='download_status'></span>
    </p>
    </div>
</div>
<div class="config_div" id="plate_solve_div" style="display:none; position:absolute; left:5%; top:5%; z-index:2 ; padding: 1% 1% 1% 1%; width: 88%; background:black; border: 1px solid red ">
    <span style="position:absolute; right:1mm; top:1mm">
        <button class="incdec_but" onclick="showSolve(false);">X</button>
    </span>
    <div id="solver_config">
        <p>
            <span class="nowr">Pixel Size (μm) <input class="val_input saved_input" id="solver_pixel_size" type="number" step="0.01" value="" oninput='recalcFOV();' />,</span>
            <span class="nowr">Focal Length (mm) <input class="val_input saved_input" id="solver_focal_length" type="number" value="" oninput='recalcFOV();' /></span>
        </p>
        <p>Vertical FOV (°) <input class="val_input" id="solver_fov" type="number" value="" step="0.001" /></p>
        <p>Object <input class="val_input saved_input" id="solver_object" type="text" oninput='updateSolverRADE(this.value)'  value="" /> (M31, NGC457)</p>
        <p>
            <span class="nowr" >RA <input class="val_input" id="solver_ra" type="text" value="" />,</span>
            <span class="nowr" >DEC <input class="val_input" id="solver_de" type="text" value=""/></span>
        </p>
        <p>Radius (°) <input class="val_input saved_input" id="solver_radius" type="number" min="0.1" max="10.0" step="0.1" value="5.0" /></p>
        <p><button onclick="plateSolve();" >Solve</button></p>
    </div>
    <div id="solver_status_div" style="display:none;" >
        <p>Status: <span id="solver_status"></span></p>
        <p><button onclick="solverRestart();" >Restart</button></p>
        <div id="solver_result" style="display:none; text-align:center;">
            <p><img alt="Solving result" src="" id="solver_result_image" /></p>
        </div>
    </div>
</div>
<div class="alert_div" id="error_alert" style=" ">
<p id="error_message">No error</p>
<p><button onclick="hideError();">Ok</button></p>
</div>
<script src="/media/js/jsdb.js"></script>
<script src="/media/js/code.js"></script>
</body>
</html>
